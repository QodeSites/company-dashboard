generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                         Int                          @id @default(autoincrement())
  account_id                 String                       @unique
  qcode                      String                       @unique
  account_name               String
  broker                     String
  account_type               String
  email_linked               String?
  contact_number             String?
  login_id                   String?
  login_password             String?
  totp_secret                String?
  api_details                Json?
  nominees                   String?
  aadhar                     String?
  pan                        String?
  remarks                    String?                      @default("NA")
  created_at                 DateTime                     @default(now())
  account_access_source      AccountAccess[]              @relation("SourceAccount")
  account_access_target      AccountAccess[]              @relation("TargetAccount")
  pooled_account_allocations pooled_account_allocations[]
  pooled_account_users       PooledAccountUser[]

  @@map("accounts")
}

model User {
  id                         Int                          @id @default(autoincrement())
  user_id                    String                       @unique
  icode                      String                       @unique
  user_name                  String
  email                      String
  contact_number             String
  birth_date                 DateTime?
  birth_time                 String?
  birth_location             String?
  mother_name                String?
  father_name                String?
  husband_name               String?
  nominees                   String?
  emergency_contact_name     String?
  emergency_contact_number   String?
  aadhar                     String?
  pan                        String?
  residential_address        String?
  gender                     String?
  occupation                 String?
  remarks                    String?                      @default("NA")
  created_at                 DateTime                     @default(now())
  pooled_account_allocations pooled_account_allocations[]
  pooled_account_users       PooledAccountUser[]

  @@map("users")
}

model PooledAccountUser {
  id           Int      @id @default(autoincrement())
  qcode        String
  icode        String
  access_level String   @default("read")
  created_at   DateTime @default(now())
  accounts     Account  @relation(fields: [qcode], references: [qcode], map: "pooled_account_users_account_id_fkey")
  users        User     @relation(fields: [icode], references: [icode], map: "pooled_account_users_user_id_fkey")

  @@unique([qcode, icode], map: "pooled_account_users_account_id_user_id_key")
  @@map("pooled_account_users")
}

model AccountAccess {
  id                Int      @id @default(autoincrement())
  source_account_id String
  target_account_id String
  access_level      String   @default("read")
  created_at        DateTime @default(now())
  source_account    Account  @relation("SourceAccount", fields: [source_account_id], references: [qcode])
  target_account    Account  @relation("TargetAccount", fields: [target_account_id], references: [qcode])

  @@unique([source_account_id, target_account_id], map: "source_target_unique")
  @@map("account_access")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model master_sheet_qac00001 {
  id                   Int       @default(autoincrement())
  qcode                String    @db.VarChar(20)
  date                 DateTime  @db.Date
  portfolio_value      Decimal?  @db.Decimal(20, 4)
  capital_in_out       Decimal?  @db.Decimal(20, 4)
  nav                  Decimal?  @db.Decimal(20, 4)
  prev_nav             Decimal?  @db.Decimal(20, 4)
  pnl                  Decimal?  @db.Decimal(20, 4)
  daily_p_l            Decimal?  @db.Decimal(20, 4)
  exposure_value       Decimal?  @db.Decimal(20, 4)
  prev_portfolio_value Decimal?  @db.Decimal(20, 4)
  prev_exposure_value  Decimal?  @db.Decimal(20, 4)
  prev_pnl             Decimal?  @db.Decimal(20, 4)
  drawdown             Decimal?  @db.Decimal(20, 4)
  system_tag           String?   @db.VarChar(50)
  created_at           DateTime? @default(now()) @db.Timestamp(6)

  @@ignore
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model master_sheet_qac00002 {
  id                   Int       @default(autoincrement())
  qcode                String    @db.VarChar(20)
  date                 DateTime  @db.Date
  portfolio_value      Decimal?  @db.Decimal(20, 4)
  capital_in_out       Decimal?  @db.Decimal(20, 4)
  nav                  Decimal?  @db.Decimal(20, 4)
  prev_nav             Decimal?  @db.Decimal(20, 4)
  pnl                  Decimal?  @db.Decimal(20, 4)
  daily_p_l            Decimal?  @db.Decimal(20, 4)
  exposure_value       Decimal?  @db.Decimal(20, 4)
  prev_portfolio_value Decimal?  @db.Decimal(20, 4)
  prev_exposure_value  Decimal?  @db.Decimal(20, 4)
  prev_pnl             Decimal?  @db.Decimal(20, 4)
  drawdown             Decimal?  @db.Decimal(20, 4)
  system_tag           String?   @db.VarChar(50)
  created_at           DateTime? @default(now()) @db.Timestamp(6)

  @@ignore
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model master_sheet_qac00003 {
  id                   Int       @default(autoincrement())
  qcode                String    @db.VarChar(20)
  date                 DateTime  @db.Date
  portfolio_value      Decimal?  @db.Decimal(20, 4)
  capital_in_out       Decimal?  @db.Decimal(20, 4)
  nav                  Decimal?  @db.Decimal(20, 4)
  prev_nav             Decimal?  @db.Decimal(20, 4)
  pnl                  Decimal?  @db.Decimal(20, 4)
  daily_p_l            Decimal?  @db.Decimal(20, 4)
  exposure_value       Decimal?  @db.Decimal(20, 4)
  prev_portfolio_value Decimal?  @db.Decimal(20, 4)
  prev_exposure_value  Decimal?  @db.Decimal(20, 4)
  prev_pnl             Decimal?  @db.Decimal(20, 4)
  drawdown             Decimal?  @db.Decimal(20, 4)
  system_tag           String?   @db.VarChar(50)
  created_at           DateTime? @default(now()) @db.Timestamp(6)

  @@ignore
}

model pooled_account_allocations {
  id                  Int       @id @default(autoincrement())
  qcode               String?
  icode               String?
  allocation_date     DateTime  @db.Date
  contribution_amount Decimal?  @db.Decimal
  allocation_percent  Decimal?  @db.Decimal
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  users               User?     @relation(fields: [icode], references: [icode], onDelete: NoAction, onUpdate: NoAction)
  accounts            Account?  @relation(fields: [qcode], references: [qcode], onDelete: NoAction, onUpdate: NoAction)

  @@unique([qcode, icode, allocation_date])
}
